## 短线接力：实盘交易规则（竞价买入 & 次日出场）

### 适用范围与目标
- **适用**：短线接力模型每日产出 TOP3 标的，执行“次日开盘竞价买入 → 次日（或当日）盘中/尾盘出场”。
- **目标**：把你口述的经验规则整理为 **可参数化**、可执行、可回测/可审计的规则集。

---

### 核心前提（很重要）
- **买入依赖竞价信息**：你关心的是 **9:20–9:25** 的竞价过程（封单/挂单/价格变化），这通常属于 **盘口/L1/竞价指标**，不是普通日线/分钟线就能完整覆盖。
- **9:20–9:25 撤单限制**：集合竞价阶段常见规则是 **9:20–9:25 下单后不可撤单**（细节因交易所/券商而异）。因此“看不及预期就放弃”往往需要 **尽量晚决策**（接近 9:24:50 再决定是否下单）。
- **涨停 vs 跌停的成交现实**
  - **涨停可以卖**：技术上通常随时可挂单卖出；你选择“涨停不卖”是为了 **尽可能享受次日溢价**（交易纪律，而非不能卖）。
  - **跌停可能卖不掉**：尤其封死跌停/流动性枯竭时，卖单可能无法成交，需要 **顺延到下一交易日继续尝试卖出**。

---

### 参数表（建议先固定，便于回测与迭代）
| 参数 | 默认值 | 说明 |
|---|---:|---|
| `TOPK` | 3 | 每天最多买入数量 |
| `BUY_AUCTION_WINDOW` | 09:20–09:25 | 竞价观察窗口 |
| `BUY_CANCEL_CUTOFF` | 09:24:50 | 建议的“最终下单/放弃”决策时点 |
| `BUY_SKIP_OPEN_LESS_THAN` | -4% | 次日竞价形成价/开盘价低于该阈值则放弃 |
| `STRONG_SEAL_EXPECT_OPEN_MIN` | +5% | “昨天强封一字”分支：次日竞价形成价/开盘价至少高开 |
| `STRONG_SEAL_EXPECT_BID_RATIO_MIN` | 5% | “昨天强封一字”分支：次日竞价买盘 ≥ 昨日封单量的比例 |
| `INTRADAY_SOFT_STOPLOSS` | -3% | 早盘急跌容忍阈值（未破则允许观察修复） |
| `HARD_STOPLOSS` | -6% | 绝对止损（破则卖） |
| `TAKE_PROFIT_MAIN` | +8% | 主板目标止盈线 |
| `TAKE_PROFIT_GROWTH` | +12% | 创业板/科创板目标止盈线（可选） |
| `TIME_EXIT_DEADLINE` | 14:20 | 未达到目标涨幅时的时间止盈/止损截止 |
| `PULLBACK_NO_NEW_HIGH_MINUTES` | 20 min | 从高点回撤后，N分钟内不创新高则止盈 |
| `FAST_DIP_RECOVERY_MINUTES` | 10 min | 早盘急跌后允许在N分钟内修复 |

> 注：阈值建议先按你当前经验固定，跑一年回测后再做敏感性分析（例如把 +5% / 5% / -4% 做网格）。

---

## 1. 买入规则（次日集合竞价）

### 1.1 硬性排除（任何情况都不买）
- **开盘价/竞价形成价 < -4%**：放弃（你提出的 1.c）。
- **不可交易**：停牌、退市整理、风控限制等。
- **跌停或接近跌停且无买盘承接**：一般放弃（避免无法退出的风险）。

### 1.2 分支 A：昨日“强封一字涨停、封板质量很好”（你提出的 1.a）
你想做的是：**次日仍强** 才买；竞价明显走弱就放弃。

**观察与判断口径（建议）**：
- **观察窗口**：9:20–9:25（重点 9:20–9:25，9:23 后尤其关键）。
- **买入门槛（同时满足）**
  - **价格强势**：9:25 形成价（或开盘价）≥ **+5%**
  - **承接买盘**：9:25 竞价买入量 ≥ **昨日封单量的 5%**（或用“封板资金”近似）
- **转弱放弃信号（任一触发则放弃）**
  - 9:20 后封单量持续下降，并且在 9:23 后出现 **价格回落到平盘附近/明显走弱**；
  - 9:25 收盘竞价结果：虽然有买入，但价格仍 **低于 -1%**（你给的示例）。

> 说明：这里的“封单量持续下降”建议你后续在实现时明确为一个定量条件（例如：相对 9:20 峰值下降 > X%，且与价格走弱同时出现）。

### 1.3 分支 B：昨日“封板质量一般/有开板”（你提出的 1.b）
你想做的是：不要求大高开，但要“别太差、别弱开”。

**买入门槛（满足即可买）**：
- 次日竞价形成价/开盘价 **不低于 -3%**，且不是跌停/极端弱势；
- 平开或小幅高开可以参与。

---

## 2. 卖出规则（次日盘中 + 时间止盈）

### 2.1 硬性止损（兜底）
- **跌破 -6%**：立即止损卖出（你能承受的下限）。
- **跌停卖不出**：记录为“未成交”，下一交易日继续尝试卖出（顺延机制）。

### 2.2 早盘“急跌后快速修复”——允许不卖（你提出的 2.a）
**触发场景**：开盘后快速下跌，但属于“洗盘回拉”的典型。

**口径（建议）**：
- 若早盘快速下跌但 **未跌破 -3%**，并且在 **10分钟内**拉回到：
  - 分时均线/ VWAP 附近，或
  - 回到红盘（≥0%）
  
则 **不立即卖**，继续持有观察。

**反例（建议立即处理）**：
- 跌破 -3% 且 10分钟内无法有效修复，或修复后再次快速转弱。

### 2.3 目标止盈与时间止盈（你提出的 2.b）
- 若当日达到目标涨幅：
  - 主板：≥ **+8%**
  - 创业板/科创板：可放宽到 **+12%**
  
则按你的纪律处理（可以分批止盈/或继续持有观察，但要配合 2.4 的回撤止盈）。

- 若 **到下午仍未达到目标涨幅**：
  - 在 **14:20 前**卖出，避免尾盘不确定性与隔夜风险。

### 2.4 回撤止盈（你提出的 2.c）
**口径（建议）**：
- 若价格从当日高点回落后，**20分钟内不再创新高**，则及时止盈卖出（即使没达到 +8/+12）。

### 2.5 “涨停不卖”的纪律（你纠正后的真实含义）
- **涨停可以卖**，但你选择“不卖”是为了尽可能吃 **次日溢价**。
- 若涨停打开、或出现明显开板走弱/回封失败，则可按 2.4 的“回撤止盈”或你自定义规则处理。

---

## 3. 异常与边界处理（必须写清楚，否则实盘会失真）

### 3.1 无法卖出（重点：跌停/停牌/极端流动性）
- 当天触发卖出条件但 **无法成交**：
  - 记录原因（停牌/跌停/无流动性/风控拒单）
  - 下一交易日继续按规则尝试卖出（优先按“开盘/尽快卖出”还是“按原规则”需要你再定）

### 3.2 一天多只 TOP3 同时触发
- 建议：等权或按模型分数分配权重（你现版本为等权 1/3）。
- 若资金不足/风控限制：优先级按 `rank` 依次下单，剩余跳过。

### 3.3 风险标的过滤（建议作为通用前置过滤器）
- ST/退市整理/新股上市不足N日/成交额过低/停牌风险等。

---

## 4. “能否在券商实盘做到这么细？”——结论与所需能力

### 4.1 可以做到，但需要的三件套
- **实时行情**：至少分钟级；若要做竞价封单变化，通常需要 **竞价盘口/L2** 或券商/行情商提供的竞价字段。
- **实时触发器**：你的 10分钟修复、20分钟不创新高、14:20 强制卖，都需要盘中持续运行的策略进程。
- **实时下单通道**：券商交易 API / 终端“文件单/脚本接口”等。

### 4.2 仅用“日频信号 + 定时下单”的局限
- 只能做到“某天开盘买、某天收盘卖”这种粗粒度；
- 你提出的竞价细分与分钟级出场，需要升级到 **分钟级/事件驱动执行**。

---

## 5. 与回测的关系（你当前 BigQuant 一年回测的取舍）

### 5.1 日线回测能覆盖的部分
- “次日开盘买入”“次日按开盘/收盘卖出”的粗规则可以做近似评估。

### 5.2 日线回测覆盖不了的部分（需要分钟级）
- 9:20–9:25 竞价过程（封单量变化）
- 10分钟修复、20分钟不创新高、14:20 强制卖

> 建议路径：先用日线回测验证大方向收益与稳定性；若收益可观，再做分钟级回测或半实盘仿真，把“竞价过滤 + 盘中出场”加入。

---

### 附：建议你后续补充的两类口径（方便实现）
- **封板质量评分（昨日）**：是否一字/是否开板/封板时间/炸板次数/封单资金等，形成可量化分数，决定走“分支A还是B”。
- **竞价承接指标（次日）**：竞价形成价、竞价成交量、封单变化速率、买盘占比等，形成“是否不及预期”的量化判定。

