## 项目路线图与实盘风险清单（试行→优化→实盘量化）

### 0. 目标与边界
- **目标**：作为“短线接力筛选器”，在每日收盘后给出次日更可能被接力、晋级/连板概率更高的标的清单，并提供解释性报告（强度分/规则概率/ML概率/综合概率）。
- **边界**：
  - **不做**：长期价值投资；财务报表因子（valuation）不纳入短线判断；盘中全自动高频决策。
  - **先做**：收盘后批量分析 + 次日人工/半自动执行；在足够稳定后，再做券商接口自动下单。

### 1. 试运行（1 周，收盘后每日）
#### 1.1 每日固定流程（T 日收盘后）
- **数据更新（最小集）**
  - 更新增强特征 CSV：`data/raw/hot_rank.csv`、`data/raw/concept_component.csv`、`data/raw/concept_bar.csv`、`data/raw/auction_factors.csv`
  - 更新市场情绪 DB：`data/market_sentiment.db`（同花顺热点板块 + 乐咕乐股赚钱效应）
  - 更新龙虎榜席位明细 DB：`data/dragon_seats.db`（同花顺 report 页）
  - 更新上证指数：`data/raw/index_bar1d.csv`（仅上证：`000001.SH`）
  - K 线 / 筹码 / 龙虎榜（BigQuant 汇总）按需增量：`data/raw/kline/kline_all.csv`、`data/raw/chips_all.csv`、`data/raw/limit_up/dragon_list.csv`
- **批量预测**
  - 运行：`predict_stock.py --batch`（按实际需求加 `--force-today`）
  - 输出：`data/predictions_trigger_YYYYMMDD.json`
- **记录（必须）**
  - 当日候选清单（最终输出标的、概率、结论等级）
  - 关键环境信息：市场情绪分级、上证环境（ret/MA/量能比）
  - 异常日志：数据缺失、回退、补数失败、API限流

#### 1.2 试运行期间的验收口径（建议）
- **覆盖率**：涨停池标的中，成功生成完整报告的比例（目标 ≥ 95%）。
- **稳定性**：无崩溃；关键数据源缺失时能降级运行（不会“静默成功”）。
- **一致性**：同一 trigger_date 的结果可复现；不会重复分析已存在结果（同 trigger_date）。
- **解释性**：每个“高概率”标的能说明：板质量/A2/A3/情绪/席位结构等贡献。

### 2. 优化与测试（1 周）
#### 2.1 调优策略（先规则、后模型）
- **规则层（优先）**
  - 把“高风险信号”显式扣分（例如高位+获利盘高+量比低等组合）。
  - 将 `sentiment_score` 只作为“档位”使用，避免 0/100 极端影响；使用分级 + 小倍率。
  - 上证环境风控（下跌放量、连跌跌破 MA5 等）作为统一乘子。
- **特征层**
  - A3：确认概念数据更新到当天；若缺失则明确提示并回退到 T-1。
  - A5：席位明细的单位/数量级校验；异常值保护（ratio 必须 0~1）。
- **模型层（条件触发）**
  - 若确认过去训练阶段增强特征长期缺失（默认值占比高），建议在增强特征补齐后 **重训 1 次**。

#### 2.2 测试清单（每次改动后）
- **冒烟**：`predict_stock.py --symbol 000620`（或任一固定样例）
- **批量**：`predict_stock.py --batch`（检查重复分析、触发日对齐、数据补充调用次数）
- **数据对齐**：确认增强特征 CSV 的 `max(date)` ≥ trigger_date
- **A5 量纲**：抽查 3 只股票的 `total_buy_yuan/total_net_yuan` 是否在合理数量级（万/亿）

### 3. 实盘量化准备（月底最后一周）
#### 3.1 上线前“门槛”（建议）
- 试运行+优化后，能稳定输出“高潜力标的”且日志干净、缺失率低。
- 有一套明确的**下单策略**（何时买、买多少、何时卖、止损/止盈、涨跌停处理）。
- 有**人工接管**方案：任何异常可一键停止自动下单。

#### 3.2 BigQuant → 万和证券（策略化落地）要点
- **策略输入**：每日收盘后生成 `signals.json`（标的/方向/仓位建议/有效期/原因）。
- **执行层**：次日开盘/集合竞价/盘中条件触发的委托逻辑（需要你最终定规则）。
- **风控**：
  - 仓位上限（总仓、单票、单行业/概念）
  - 禁止交易：ST/退市风险/停牌/一字板等
  - 流动性：成交额阈值、滑点预估、分笔成交限制
- **监控与审计**：
  - 每笔委托、成交回报、持仓、风控触发原因都写入日志/数据库
  - 异常（断线/拒单/超时）自动报警并降级

### 4. 风险与实盘注意事项（必须清单）
#### 4.1 数据与信号风险
- 数据滞后/缺失：增强特征、概念数据、竞价因子必须校验日期；否则回退到 T-1 并提示。
- 口径差异：同花顺热点 vs BigQuant 概念名称不完全一致；A3 用涨幅 TopN，热点用 rank。
- 停牌/复牌：停牌日不参与指标计算；复牌波动需额外防护。

#### 4.2 交易执行风险
- 涨跌停不可成交、一字板无法买入/卖出。
- 滑点与冲击成本：短线接力对滑点敏感，需限制追价与成交量占比。
- 情绪退潮日：指数下跌放量/连跌跌破均线时，需要整体减仓或暂停。

#### 4.3 人性与纪律风险（你提出的核心）
- **强制流程化**：任何人工“临时改变主意”必须有记录（理由/结果），用于后续复盘。
- **分离决策与执行**：模型给“候选”，执行严格按预案与风控走，减少临场情绪干扰。

### 5. 资料链接（仓库内）
- `docs/SHORT_TERM_RELAY_FEATURES_SPEC.md`：特征分层、字段定义、缺失策略
- `docs/RUNBOOK_20260120.md`：每周数据与训练 Runbook
- `docs/DATA_STORAGE_POSTGRES_PLAN.md`：未来 Postgres 迁移蓝图

