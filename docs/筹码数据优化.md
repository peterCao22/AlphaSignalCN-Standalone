# ç­¹ç æ•°æ®ä¼˜åŒ–æ–¹æ¡ˆ

## ğŸ“ èƒŒæ™¯

åœ¨é¢„æµ‹åˆ†æä¸­å‘ç°ï¼Œéƒ¨åˆ†ä¸ªè‚¡çš„ç­¹ç æ•°æ®æ˜¾ç¤º `0.0%`ï¼ŒåŸå› æœ‰ä¸¤ä¸ªï¼š
1. **æ•°æ®ç¼ºå¤±**ï¼šè¯¥è‚¡ç¥¨æ²¡æœ‰ç­¹ç æ•°æ®
2. **æ•°æ®è¿‡æœŸ**ï¼šç­¹ç æ•°æ®æœ€æ–°æ—¥æœŸä¸åˆ†ææ—¥æœŸä¸åŒ¹é…

ä¾‹å¦‚ï¼š002112 ä¸‰å˜ç§‘æŠ€åœ¨ 2026-01-14 åˆ†ææ—¶ï¼Œç­¹ç æ•°æ®åªåˆ° 2025-12-31ï¼Œå¯¼è‡´æ˜¾ç¤º `0.0%`ã€‚

---

## ğŸ¯ ä¼˜åŒ–æ–¹æ¡ˆ

### 1ï¸âƒ£ **å¢é‡è¡¥å……åŠŸèƒ½**ï¼ˆLayer3DataSupplementï¼‰

æ–°å¢ `supplement_chips_data` æ–¹æ³•ï¼Œ**åªä¸‹è½½ç¼ºå¤±æˆ–è¿‡æœŸçš„ä¸ªè‚¡æ•°æ®**ã€‚

#### ç‰¹æ€§

| åŠŸèƒ½ | è¯´æ˜ |
|------|------|
| **æ™ºèƒ½æ£€æµ‹** | è‡ªåŠ¨æ£€æµ‹å“ªäº›è‚¡ç¥¨ç¼ºå¤±æ•°æ®æˆ–æ•°æ®è¿‡æœŸï¼ˆ>7å¤©ï¼‰ |
| **å¢é‡ä¸‹è½½** | åªä¸‹è½½éœ€è¦æ›´æ–°çš„è‚¡ç¥¨ï¼Œé¿å…æµªè´¹æµé‡ |
| **å»é‡åˆå¹¶** | è‡ªåŠ¨ä¸å·²æœ‰æ•°æ®åˆå¹¶å¹¶å»é‡ |
| **æ—¥å¿—è¯¦ç»†** | æ¸…æ™°æ˜¾ç¤ºæ¯åªè‚¡ç¥¨çš„æ•°æ®çŠ¶æ€ |

#### ä½¿ç”¨æ–¹æ³•

```python
from stockainews.services.layer3_data_supplement import Layer3DataSupplement

supplement_service = Layer3DataSupplement()

# ä»…è¡¥å……æŒ‡å®šè‚¡ç¥¨çš„ç­¹ç æ•°æ®
df = supplement_service.supplement_chips_data(
    stock_codes=['002112', '300346'],  # åªä¸‹è½½è¿™ä¸¤åªè‚¡ç¥¨
    start_date='2025-12-01',
    end_date='2026-01-14'
)
```

#### è¾“å‡ºç¤ºä¾‹

```
å¼€å§‹è¡¥å……ç­¹ç æ•°æ®: 2åªè‚¡ç¥¨, 2025-12-01 è‡³ 2026-01-14
å‘ç°å·²æœ‰ç­¹ç æ•°æ®æ–‡ä»¶: data/raw/chips_all.csv, å…± 1218 æ¡è®°å½•

  002112: æœ€æ–°æ•°æ® 2025-12-31 (è½å14å¤©), éœ€è¦æ›´æ–°
  300346: æ•°æ®å·²æ˜¯æœ€æ–° (2026-01-13), è·³è¿‡

éœ€è¦æ›´æ–° 1 åªè‚¡ç¥¨çš„ç­¹ç æ•°æ®
ä½¿ç”¨ BigQuant SDK ä¸‹è½½ç­¹ç æ•°æ®: 2025-12-01 è‡³ 2026-01-14
âœ“ BigQuant è¿”å› 15 æ¡ç­¹ç è®°å½•
åˆå¹¶æ–°æ—§ç­¹ç æ•°æ®...
åˆå¹¶åæ•°æ®: 1233 æ¡è®°å½•ï¼ˆåŸæœ‰ 1218 æ¡ï¼Œæ–°å¢ 15 æ¡ï¼‰
âœ“ ç­¹ç æ•°æ®å·²ä¿å­˜: data/raw/chips_all.csv, å…± 1233 æ¡è®°å½•
```

---

### 2ï¸âƒ£ **å›é€€æŸ¥è¯¢é€»è¾‘**ï¼ˆPatternMatcherï¼‰

åœ¨ `pattern_matcher.py` çš„ `get_stock_features` æ–¹æ³•ä¸­ï¼Œæ–°å¢**ç­¹ç æ•°æ®å›é€€æŸ¥è¯¢**ã€‚

#### å·¥ä½œæµç¨‹

```
1. å°è¯•è·å–å½“æ—¥ç­¹ç æ•°æ®
   â”œâ”€ æˆåŠŸ â†’ ä½¿ç”¨å½“æ—¥æ•°æ®
   â””â”€ å¤±è´¥ â†’ æ‰§è¡Œå›é€€æŸ¥è¯¢
       â”œâ”€ æŸ¥æ‰¾ [date-7å¤©, date] èŒƒå›´å†…çš„æ•°æ®
       â”œâ”€ æ‰¾åˆ°æœ€è¿‘çš„ä¸€æ¡æ•°æ®
       â”œâ”€ ä½¿ç”¨è¯¥æ•°æ®å¹¶è®°å½•æ—¥å¿—
       â””â”€ å¦‚æœ7å¤©å†…æ— æ•°æ® â†’ ä½¿ç”¨é»˜è®¤å€¼ 0.0%
```

#### ä»£ç å®ç°

```python
try:
    # å°è¯•è·å–å½“æ—¥ç­¹ç æ•°æ®
    chip_row = chips_df.loc[(symbol, date)]
    win_percent = float(chip_row['win_percent'])
    # ...
except KeyError:
    # ã€ä¼˜åŒ–ã€‘å‘å‰æŸ¥æ‰¾7å¤©å†…æœ€è¿‘æ•°æ®
    lookback_start = target_date - timedelta(days=7)
    recent_chips = stock_chips[
        (stock_chips.index >= lookback_start) & 
        (stock_chips.index <= target_date)
    ]
    if not recent_chips.empty:
        chip_row = recent_chips.iloc[-1]
        # ä½¿ç”¨æ‰¾åˆ°çš„æ•°æ®
        logging.info(f"ä½¿ç”¨ {actual_date} çš„ç­¹ç æ•°æ®ï¼ˆå‘å‰å›æº¯{days_diff}å¤©ï¼‰")
```

#### æ•ˆæœ

**ä¼˜åŒ–å‰**ï¼š
```
2026-01-14 åˆ†æ 002112.SZ
ç­¹ç æ•°æ®: æ‰¾ä¸åˆ° 2026-01-14 çš„æ•°æ®
æ˜¾ç¤º: è·åˆ©ç›˜æ¯”ä¾‹ 0.0%, ç­¹ç é›†ä¸­åº¦ 0.0000
```

**ä¼˜åŒ–å**ï¼š
```
2026-01-14 åˆ†æ 002112.SZ
ç­¹ç æ•°æ®: æ‰¾ä¸åˆ° 2026-01-14 çš„æ•°æ®
å›é€€æŸ¥è¯¢: ä½¿ç”¨ 2025-12-31 çš„ç­¹ç æ•°æ®ï¼ˆå‘å‰å›æº¯14å¤©ï¼‰
æ˜¾ç¤º: è·åˆ©ç›˜æ¯”ä¾‹ 41.14%, ç­¹ç é›†ä¸­åº¦ 0.092425
```

---

### 3ï¸âƒ£ **è‡ªåŠ¨è¡¥å……é›†æˆ**ï¼ˆpredict_stock.pyï¼‰

åœ¨ `check_and_supplement_data` å‡½æ•°ä¸­ï¼Œæ–°å¢**ç­¹ç æ•°æ®è‡ªåŠ¨æ£€æŸ¥å’Œè¡¥å……**ã€‚

#### æ£€æŸ¥é€»è¾‘

```python
def check_and_supplement_data(symbol, supplement_service):
    # 1. æ£€æŸ¥Kçº¿æ•°æ®...
    
    # 2. ã€æ–°å¢ã€‘æ£€æŸ¥ç­¹ç æ•°æ®
    chips_df = pd.read_csv('data/raw/chips_all.csv')
    stock_chips = chips_df[chips_df['instrument'] == symbol]
    
    if stock_chips.empty:
        # æ— æ•°æ® â†’ éœ€è¦è¡¥å……
        needs_chips_supplement = True
    else:
        latest_chips_date = stock_chips['date'].max()
        days_behind = (datetime.now() - latest_chips_date).days
        
        if days_behind > 7:
            # æ•°æ®è¿‡æœŸ â†’ éœ€è¦è¡¥å……
            needs_chips_supplement = True
    
    if needs_chips_supplement:
        supplement_service.supplement_chips_data(
            stock_codes=[stock_code],
            start_date=(datetime.now() - timedelta(days=90)).strftime('%Y-%m-%d'),
            end_date=datetime.now().strftime('%Y-%m-%d')
        )
```

#### ä½¿ç”¨æ•ˆæœ

```bash
# è¿è¡Œé¢„æµ‹æ—¶ï¼Œè‡ªåŠ¨æ£€æµ‹å¹¶è¡¥å……ç­¹ç æ•°æ®
python predict_stock.py --symbol 002112

# è¾“å‡ºï¼š
002112.SZ ç­¹ç æ•°æ®å·²è¿‡æœŸï¼ˆæœ€æ–°: 2025-12-31, è½å14å¤©ï¼‰ï¼Œéœ€è¦è¡¥å……
å¼€å§‹è¡¥å…… 002112.SZ çš„ç­¹ç æ•°æ®...
âœ“ 002112.SZ ç­¹ç æ•°æ®è¡¥å……å®Œæˆ
```

---

## ğŸ¯ å¯¹æ¯”æ€»ç»“

| ä¼˜åŒ–ç‚¹ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å |
|--------|--------|--------|
| **æ•°æ®ç¼ºå¤±å¤„ç†** | æ˜¾ç¤º 0.0% | è‡ªåŠ¨ä¸‹è½½è¡¥å…… |
| **æ•°æ®è¿‡æœŸå¤„ç†** | æ˜¾ç¤º 0.0% | è‡ªåŠ¨ä¸‹è½½ + å›é€€æŸ¥è¯¢ |
| **ä¸‹è½½èŒƒå›´** | ä¸‹è½½æ‰€æœ‰è‚¡ç¥¨ï¼ˆæµªè´¹æµé‡ï¼‰ | ä»…ä¸‹è½½ç¼ºå¤±/è¿‡æœŸè‚¡ç¥¨ |
| **æŸ¥è¯¢é€»è¾‘** | æ‰¾ä¸åˆ°å½“æ—¥æ•°æ®å°±æ”¾å¼ƒ | å‘å‰æŸ¥æ‰¾7å¤©å†…æœ€è¿‘æ•°æ® |
| **ç”¨æˆ·ä½“éªŒ** | éœ€è¦æ‰‹åŠ¨è¡¥å…… | è‡ªåŠ¨æ£€æµ‹è‡ªåŠ¨è¡¥å…… |

---

## ğŸ“Š å®é™…æ¡ˆä¾‹ï¼š002112

### ä¼˜åŒ–å‰

```
è·åˆ©ç›˜æ¯”ä¾‹: 0.0%
ç­¹ç é›†ä¸­åº¦: 0.0000
â†’ è¯„åˆ†åé«˜ï¼ˆç¼ºå°‘è·åˆ©ç›˜å‹åŠ›çš„è´Ÿé¢å½±å“ï¼‰
```

### ä¼˜åŒ–å

```
è·åˆ©ç›˜æ¯”ä¾‹: 41.14%
ç­¹ç é›†ä¸­åº¦: 0.092425
å¹³å‡æˆæœ¬: 13.71å…ƒ
å½“å‰ä»·æ ¼: 65.20å…ƒ
ä»·æ ¼/æˆæœ¬: +375.6%
â†’ è¯„åˆ†æ›´å‡†ç¡®ï¼ˆåæ˜ å®é™…è·åˆ©ç›˜å‹åŠ›ï¼‰
```

---

## ğŸ§ª æµ‹è¯•

è¿è¡Œæµ‹è¯•è„šæœ¬éªŒè¯åŠŸèƒ½ï¼š

```bash
cd "d:\myCursor\StockAiNews\TradingAgents-chinese-market\AlphaSignal-CN"
python test_chips_supplement.py
```

---

## ğŸ“ æ–‡ä»¶æ¸…å•

| æ–‡ä»¶ | ä¿®æ”¹å†…å®¹ |
|------|----------|
| `stockainews/services/layer3_data_supplement.py` | æ–°å¢ `supplement_chips_data` æ–¹æ³• |
| `TradingAgents-chinese-market/AlphaSignal-CN/predict_stock.py` | é›†æˆç­¹ç æ•°æ®è‡ªåŠ¨æ£€æŸ¥å’Œè¡¥å…… |
| `TradingAgents-chinese-market/AlphaSignal-CN/scripts/pattern_matcher.py` | æ–°å¢ç­¹ç æ•°æ®å›é€€æŸ¥è¯¢é€»è¾‘ |
| `TradingAgents-chinese-market/AlphaSignal-CN/test_chips_supplement.py` | æµ‹è¯•è„šæœ¬ |
| `TradingAgents-chinese-market/AlphaSignal-CN/docs/CHIPS_DATA_OPTIMIZATION.md` | æœ¬æ–‡æ¡£ |

---

**ä¼˜åŒ–å®Œæˆï¼ç°åœ¨é¢„æµ‹æ—¶ä¸ä¼šå†å‡ºç° 0.0% çš„ç­¹ç æ•°æ®äº†ï¼** âœ…
